<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Tagesplan RWG</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    select { font-size: 1rem; margin-bottom: 1rem; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

<h1>RWG Tagesplan</h1>

<label for="klasse">Klasse wählen:</label>
<select id="klasse">
  <option value="11A" selected>11A</option>
  <option value="10A">10A</option>
  <option value="9A">9A</option>
  <!-- Weitere Klassen nach Bedarf -->
</select>

<table id="plan">
  <thead>
    <tr>
      <th>Stunde</th>
      <th>Zeit</th>
      <th>Fach</th>
      <th>Lehrer</th>
      <th>Raum</th>
      <th>Info</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const XML_URL = 'https://www.rwg-waren.de/stundenplan/vplan/mobdaten/Klassen.xml';

document.getElementById('klasse').addEventListener('change', ladePlan);
window.addEventListener('load', ladePlan);

function ladePlan() {
  const klasse = document.getElementById('klasse').value;
  fetch(XML_URL)
    .then(res => res.text())
    .then(xmlString => new window.DOMParser().parseFromString(xmlString, "text/xml"))
    .then(xml => {
      const klassen = xml.getElementsByTagName("Kl");
      let stunden = [];

      for (let kl of klassen) {
        const kurz = kl.getElementsByTagName("Kurz")[0]?.textContent?.trim();
        if (kurz === klasse) {
          const stds = kl.getElementsByTagName("Std");
          for (let std of stds) {
            stunden.push({
              st: std.getElementsByTagName("St")[0]?.textContent ?? "",
              beginn: std.getElementsByTagName("Beginn")[0]?.textContent ?? "",
              ende: std.getElementsByTagName("Ende")[0]?.textContent ?? "",
              fach: std.getElementsByTagName("Fa")[0]?.textContent ?? "",
              lehrer: std.getElementsByTagName("Le")[0]?.textContent ?? "",
              raum: std.getElementsByTagName("Ra")[0]?.textContent ?? "",
              info: std.getElementsByTagName("If")[0]?.textContent ?? ""
            });
          }
          break;
        }
      }

      stunden.sort((a, b) => Number(a.st) - Number(b.st));
      const tbody = document.querySelector("#plan tbody");
      tbody.innerHTML = "";
      for (let s of stunden) {
        tbody.innerHTML += `
          <tr>
            <td>${s.st}</td>
            <td>${s.beginn}–${s.ende}</td>
            <td>${s.fach}</td>
            <td>${s.lehrer}</td>
            <td>${s.raum}</td>
            <td>${s.info}</td>
          </tr>`;
      }
    })
    .catch(err => {
      console.error('Fehler beim Laden:', err);
      alert('Plan konnte nicht geladen werden.');
    });
}
</script>

</body>
</html>